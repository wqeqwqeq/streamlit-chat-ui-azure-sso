# ======================================================================
# DAPE OpsAgent Manager - Environment Configuration Template
# ======================================================================
# Copy this file to .env and fill in your actual values
# The .env file should NEVER be committed to version control
# ======================================================================

# ======================================================================
# Chat History Storage Configuration
# ======================================================================

# Storage mode for chat history
# Options:
#   - local:       JSON files in .chat_history/ directory (no database required)
#   - local_psql:  Azure PostgreSQL with hardcoded test user (for local development/testing)
#   - postgres:    Azure PostgreSQL with real SSO user from Azure Easy Auth headers
#   - local_redis: Azure Redis + Azure PostgreSQL with test user (for Redis cache testing)
#   - redis:       Azure Redis + Azure PostgreSQL with SSO user (production with cache)
CHAT_HISTORY_MODE=local

# Number of days of conversation history to load on startup
# Default: 7 (only loads conversations created in the last 7 days)
# Set to higher value if you need longer history, but may impact startup time
CONVERSATION_HISTORY_DAYS=7


# ======================================================================
# Azure Infrastructure Deployment (for deploy_infra.sh)
# ======================================================================

# Azure subscription ID (find with: az account show --query id -o tsv)
AZURE_SUBSCRIPTION_ID=00000000-0000-0000-0000-000000000000

# Resource group name (will be created by deploy_infra.sh rg)
AZURE_RESOURCE_GROUP=your-resource-group-name

# Azure region for all resources (e.g., eastus, westus2, centralus)
AZURE_LOCATION=eastus2

# Resource prefix for all Azure resources
# Example: stanley-dev-ui
# Resources will be named: {RESOURCE_PREFIX}-app, {RESOURCE_PREFIX}-postgres, etc.
RESOURCE_PREFIX=stanley-dev-ui

# ======================================================================
# Virtual Network Configuration
# ======================================================================

# VNet address space in CIDR notation
# Example: 10.0.0.0/16 provides 65,536 addresses
# Ensure this doesn't conflict with other VNets in your subscription
VNET_ADDRESS_SPACE=10.0.0.0/16

# App Service subnet address prefix in CIDR notation
# Example: 10.0.1.0/26 provides 64 addresses (recommended minimum for App Service)
# Must be within the VNet address space defined above
# Minimum /28 (16 addresses), recommended /26 (64 addresses) for scalability
SUBNET_ADDRESS_PREFIX=10.0.1.0/26

# ======================================================================
# App Service Configuration
# ======================================================================

# App Service Plan SKU
# Options: b1 (Basic), s1 (Standard), p1v2 (Premium v2), etc.
# See: https://azure.microsoft.com/en-us/pricing/details/app-service/linux/
APP_SERVICE_SKU=b1

# Azure AD App Registration Client ID for Easy Auth (SSO)
# This should be the Application (client) ID from your Azure AD App Registration
TOKEN_PROVIDER_APP_ID=00000000-0000-0000-0000-000000000000


# ======================================================================
# Local PostgreSQL Testing Mode (local_psql mode only)
# ======================================================================
# When CHAT_HISTORY_MODE=local_psql, the app will:
#   1. Connect to the SAME Azure PostgreSQL instance as production
#   2. Use these hardcoded credentials instead of SSO headers
#   3. Display "ðŸ§ª Local PostgreSQL Mode" in the sidebar
#
# This allows local development and testing without deploying to Azure

# Test user client ID (Azure Entra ID format UUID)
LOCAL_TEST_CLIENT_ID=00000000-0000-0000-0000-000000000001

# Test user display name
LOCAL_TEST_USERNAME=local_user

# ======================================================================
# PostgreSQL Connection (postgres/local_psql modes only)
# ======================================================================
# Connection string is automatically built from individual parameters below
# For local development: Point to your Azure PostgreSQL Flexible Server


# PostgreSQL server hostname (without port)
# Example: stanley-dev-ui-postgres.postgres.database.azure.com
POSTGRES_HOST=your-postgres-server.postgres.database.azure.com

# PostgreSQL port (default: 5432)
POSTGRES_PORT=5432

# Database name (default: chat_history)
# NOTE: This is also used by deploy_infra.sh to create the database
POSTGRES_DATABASE=chat_history

# SSL mode (require, verify-ca, verify-full)
# Azure PostgreSQL requires SSL, so use 'require' or higher
POSTGRES_SSLMODE=require

# PostgreSQL administrator login name (cannot be 'admin', 'administrator', etc.)
POSTGRES_ADMIN_LOGIN=pgadmin

# PostgreSQL administrator password
# Requirements: 8-128 chars, must contain uppercase, lowercase, and numbers
POSTGRES_ADMIN_PASSWORD=YourSecurePassword123!

# PostgreSQL SKU (pricing tier + compute size)
# Burstable: Standard_B1ms, Standard_B2s
# General Purpose: Standard_D2s_v3, Standard_D4s_v3
# Memory Optimized: Standard_E2s_v3, Standard_E4s_v3
# See: https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-compute-storage
POSTGRES_SKU=Standard_B1ms

# Storage size in GB (32 GB to 32 TB)
# Start small and scale up as needed
POSTGRES_STORAGE_GB=32


# ======================================================================
# Redis Cache Configuration (local_redis/redis modes only)
# ======================================================================

# Redis server hostname
# Azure: {RESOURCE_PREFIX}-redis.redis.cache.windows.net (from Bicep output)
# Get from: az deployment group show --query properties.outputs.redisHostName
REDIS_HOST=your-redis-server.redis.cache.windows.net

# Redis port (Azure always uses SSL port 6380)
REDIS_PORT=6380

# Redis password/access key
# Get from Azure Portal â†’ Redis Cache â†’ Access keys â†’ Primary
# Or from Key Vault secret: redis-password
REDIS_PASSWORD=your_redis_primary_key_here

# Enable SSL/TLS connection (always true for Azure)
REDIS_SSL=true

# TTL for Redis keys in seconds (default: 1800 = 30 minutes)
REDIS_TTL_SECONDS=1800


# ======================================================================
# Local Development Tips
# ======================================================================
# 1. Start with CHAT_HISTORY_MODE=local for initial development
# 2. Deploy Azure infrastructure: ./deployment/deploy_infra.sh app
# 3. Switch to CHAT_HISTORY_MODE=local_psql to test PostgreSQL locally
# 4. Deploy to Azure: ./deployment/deploy_script.sh
# 5. Production uses CHAT_HISTORY_MODE=postgres (auto-configured by Bicep)
# ======================================================================
